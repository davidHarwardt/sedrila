# `sedrila viewer`: browse task solution files

`sedrila viewer` is a webserver tailored to `sedrila`.
Its main purpose is helping instructors view students' solution files.
In particular, it marks and collects files pertaining to submitted tasks and
renders command protocols such that they become easy to read.
It also helps students check the correctness of their command protocols.  
It allows browsing multiple directory trees in parallel (showing the merged union of them)
and marks files that are identical between them.

**Note:** A new version of `viewer` is currently being implemented.
The first description below refers to the old version, which is still available under the name `viewer1`.


## 0. Assumptions

Several assumptions about the SeDriLa in question are built into `sedrila viewer`. In particular:

- The underlying SeDriLa prescribes submission filenames and directory structure precisely, 
  so that the directory trees can be merged naturally and corresponding files identified easily.
- For many or most submission files, their basename (without the suffix) will be the name of the
  corresponding task, so that viewer can read `submission.yaml` and then identify (and mark)
  most of those files in the directory tree that are relevant for the current submission.
- Instructors will lay out their working directory such that the clone of each student's workdir
  is named according to the `student_gituser` value in their `student.yaml`.


## 1. Basic use

- Either go to the work directory of a student repo and call `sedrila viewer` for viewing a single workdir.
- Or go to the top directory of an instructor directory tree and call something like
  `sedrila viewer studentdir1 studentdir2` for viewing a merged view of multiple workdirs.
- Viewer reads each `student.yaml` and extracts student metadata.  
  It reads each `submission.yaml` and obtains the list of tasks mentioned therein.  
  It collects all paths across all the workdirs and prepares a joint directory tree.  
  It collects all paths involving names of submitted tasks.  
- Visit `http://localhost:8077` in your web browser.
- Viewer shows a listing of submission-related files, 
  of remaining tasks (not reflected in the submission-related files),
  of subdirectories,
  and of files in the current directory.
- File names link to a page showing both versions of the file, plus a diff.
- File contents of most file types will be rendered:
  *.md files as Markdown, *.prot files as command protocols, program source code as such (with syntax highlighting).
  All files whose names start with the name of a task mentioned in `submission.yaml` are highlighted
  in boldface. Behind them, a link to the respective task on the course webpage is shown.
- For the file links:  
    - `*.md` files will be rendered as Markdown.
    - `*.py`, `*.html`, `*.js`, `*.java` files and many other kinds with known syntax 
      will be rendered with syntax highlighting.
    - `*.html` files will additionally have a link to show the file as an HTML page.
    - `*.prot` plaintext files will be rendered in color, with highlighting of prompts and commands.
- A breadcrumb navigation is shown at the top.
- When done, go back to the shell and stop the webserver by pressing Ctrl-C.


## 2. Options

- `--port 8003`: Make `viewer` use some other port (here: port 8003)
- `--instructor`: The task link will point at the instructor version of the website
  rather than the student version. 
  This will only work if the structure generated by `sedrila author` is kept, 
  where the instructor site is a subdirectory of the student site.


## 3. What else

- The viewer will emit warnings for several types of inconsistencies such as
    - wrongly named workdirs (their names, if given, must be that of the `student_gituser` given in `student.yaml`)
    - pairs that do not officially (according to `student.yaml`) belong together
    - students not listed in `participants.csv` (if that file exists)
- The viewer will terminate with an error message if the values of `course_url` given in 
  any `student.yaml` differ from each other.
- In principle, you can also call the viewer with more than two workdirs. YMMV. 

That's all.

-----

## 1. Idea

`sedrila viewer` allows browsing through either one student SeDriLa work directory
or several at once.
It incorporates several assumptions:

- If you supply several directories, say `a`, `b`, `c`, `d`, then `a` and `b` belong to a pair
  of students who have been asked to collaborate and are allowed to submit identical of very similar
  versions of some of the files. `c` and `d` form another such pair.  

Viewer will:

- Form a virtual file system containing the union of the directory trees.
- 


## 2. Basic use

- For browsing a single student repo, go to the work directory of that student repo and call
  `sedrila viewer .`.
- For browsing multiple repos `a`, `b`, go to the joint superdirectory of these and call
  `sedrila viewer a b`.
- Visit `http://localhost:8080` in your web browser.
- Viewer reads each `student.yaml` and extracts course URL, student name, and partner name.
  It reads each `submission.yaml` and obtains the list of tasks mentioned therein.
- ...


## 3. ...

